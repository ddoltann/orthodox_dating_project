{% extends "profiles/base.html" %}
{% load static %}

{% block title %}Профиль {{ profile.user.first_name }}{% endblock %}

{% block content %}
<!-- ОСНОВНАЯ КАРТОЧКА ПРОФИЛЯ -->
<div class="card shadow-lg mb-4">
    <div class="row g-0">
        <div class="col-md-4">
            <img src="{{ profile.photo.url }}" class="img-fluid rounded-start" alt="Фото {{ profile.user.first_name }}">
        </div>
        <div class="col-md-8">
            <div class="card-body">
                <h1 class="card-title">
                    {{ profile.user.first_name }} {{ profile.patronymic }}
                    {% if profile.is_verified %}
                        <i class="bi bi-patch-check-fill text-primary" title="Профиль верифицирован"></i>
                    {% endif %}
                </h1>
                <h5 class="card-subtitle mb-2 text-muted">{{ profile.city }}, {{ profile.age }} лет</h5>
                <p class="card-text">{{ profile.about_me }}</p>
                
                <!-- Кнопки действий для других пользователей -->
                <div class="mt-3">
                    {% if user.is_authenticated and user != profile.user %}
                    <div class="d-flex gap-2">
                        <!-- Форма для симпатии -->
                        <form method="post" action="{% url 'profiles:add_like' pk=profile.user.pk %}">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-danger"><i class="bi bi-heart-fill"></i> Выразить симпатию</button>
                        </form>
                        
                        <!-- НАЧАЛО ИЗМЕНЕНИЙ: Условная кнопка сообщения -->
                        {% if mutual_like %}
                            <a href="{% url 'profiles:conversation_detail' pk=profile.user.pk %}" class="btn" style="background-color: #0c0d0b; color: #e9d884;"><i class="bi bi-chat-dots-fill"></i> Написать сообщение</a>
                        {% else %}
                            <button class="btn btn-secondary" disabled title="Написать сообщение можно только после взаимной симпатии"><i class="bi bi-chat-dots-fill"></i> Написать сообщение</button>
                        {% endif %}
                        <!-- КОНЕЦ ИЗМЕНЕНИЙ -->

                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- БЛОК ФОТОГАЛЕРЕИ -->
<div class="card shadow-lg mb-4">
    <div class="card-header">
        <h3 class="mb-0">Фотогалерея</h3>
    </div>
    <div class="card-body">
        <div class="row g-3">
            {% for photo in profile.photos.all %}
                <div class="col-6 col-md-4 col-lg-3">
                    <a href="{{ photo.image.url }}" data-bs-toggle="modal" data-bs-target="#photoModal{{ photo.id }}">
                        <img src="{{ photo.image.url }}" class="img-fluid rounded shadow-sm" alt="Фото {{ profile.user.first_name }}">
                    </a>
                </div>
            {% empty %}
                <p class="text-muted">У пользователя нет дополнительных фотографий.</p>
            {% endfor %}
        </div>
    </div>
</div>

<!-- БЛОК С ДЕТАЛЬНОЙ ИНФОРМАЦИЕЙ -->
<div class="card shadow-lg">
    <div class="card-header">
        <h3 class="mb-0">Подробная информация</h3>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <ul class="list-group list-group-flush">
                    <li class="list-group-item"><strong>Семейное положение:</strong> {{ profile.get_marital_status_display }}</li>
                    <li class="list-group-item"><strong>Дети:</strong> {{ profile.get_children_display }}</li>
                    <li class="list-group-item"><strong>Рост:</strong> {{ profile.height }} см</li>
                    <li class="list-group-item"><strong>Образование:</strong> {{ profile.education }}</li>
                    <li class="list-group-item"><strong>Профессия:</strong> {{ profile.occupation }}</li>
                </ul>
            </div>
            <div class="col-md-6">
                <ul class="list-group list-group-flush">
                    <li class="list-group-item"><strong>Степень воцерковленности:</strong> {{ profile.get_churching_level_display }}</li>
                    <li class="list-group-item"><strong>Отношение к постам:</strong> {{ profile.get_attitude_to_fasting_display }}</li>
                    <li class="list-group-item"><strong>Участие в Таинствах:</strong> {{ profile.get_sacraments_display }}</li>
                    <li class="list-group-item"><strong>Любимые святые:</strong> {{ profile.favorite_saints }}</li>
                    <li class="list-group-item"><strong>Любимые духовные книги:</strong> {{ profile.spiritual_books }}</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Модальные окна для просмотра фото -->
{% for photo in profile.photos.all %}
<div class="modal fade" id="photoModal{{ photo.id }}" tabindex="-1" aria-labelledby="photoModalLabel{{ photo.id }}" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body p-0">
        <img src="{{ photo.image.url }}" class="img-fluid" alt="Фото в полном размере">
      </div>
    </div>
  </div>
</div>
{% endfor %}
{% endblock %}





